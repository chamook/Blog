<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Choose Your Own Representation</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
		<link rel="stylesheet" href="../style.css">
  </head>
  <body>
	  	<header>
			<div class="container">
				<h1>
					  Choose Your Own Representation<br />
					  <small>
                HTTP APIs can be friendlier to clients by providing multiple
                representations of the same data
            </small>
				</h1>
			</div>
			<div class="byline">
				<div class="container">
					<p>
						By <a href="https://twitter.com/chamooktweets">Adam Guest</a> - 2019
					</p>
				</div>
			</div>
		</header>
		<article class="container">
			<section>
				  <p>
              When a client requests data from an API it may only want a subset of
              available fields, but many APIs only offer a single representation of
              available data. We can use
              <a href="https://en.wikipedia.org/wiki/Content_negotiation">Content Negotiation</a>
              for more than just choosing between json or xml (or whatever)
              and provide exactly what a client asks for.
          </p>
          <h3>A Sample API</h3>
          <p>
              Many applications use the concept of a collection of items that
              belong to a user, so here we'll use a collection of favourite
              colours<a href="#footnote-1" class="footnote-link">1</a>.
          </p>
          <p>
              We can define a simple <code>my-colours</code> endpoint in F# using
              <a href="https://github.com/giraffe-fsharp/giraffe">Giraffe</a>:
          </p>
          <script src="https://gist.github.com/chamook/88fd1442a69350e5eec382110b1ae902.js"></script>
          <p>
              This defines a <code>Colour</code> type that contains a few different
              properties, and makes a collection of them available via <code>GET</code>
              request. It returns a hardcoded list of values, but it's just an
              example so that's ok.
          </p>
          <p>
              We can also create a simple client to retrieve the data from the endpoint
              and display it to an end user. The sample swift code is part of an iOS app
              using <code>URLSession</code> and the <code>Decodable</code> protocol to
              make things easy:
          </p>
          <script src="https://gist.github.com/chamook/ba052a104197023689095ac29ea9581b.js"></script>
          <p>
              This works pretty well, but we can already see that there's a mismatch
              between the data that the API provides and the data that the client
              actually needs. For this sample API it's not much of an issue, but
              if we had a lot of entries in the list or our colour object was more
              complex it could become a problem. Fortunately, we have some ways to
              match our API to the needs of the client.
          </p>
          <h3>A New Media Type</h3>
          <p>
              We can't <em>just</em> remove values from our API response because
              there may be other clients relying on that data, but if we provide
              a way for a client to ask for a different response then we can
              give each client a response containing the data that it needs.
          </p>
          <p>
              First, we need to configure Giraffe to support custom media types.
              We don't need any custom serialization for this, so we can just
              use the json serializer that's already configured.
          </p>
          <script src="https://gist.github.com/chamook/4f7fdb4a2257d6ae89027dfd2f374abf.js"></script>
          <p>
              Then we can create a custom representation of <code>Colours</code>
              and return it from our endpoint for clients that request the mini
              version.
          </p>
          <script src="https://gist.github.com/chamook/6561ca0b26e9053a050b144d69eb0ceb.js"></script>
          <p>
              With our API configured to return the mini colour response to
              clients that request it, we can update our app client to send the
              new <code>Accept</code> header. Handily, for our swift client it's
              trivial to set an extra header:
          </p>
          <script src="https://gist.github.com/chamook/b793d64db5558dd4dcea24d922bada71.js"></script>
          <p>
              Now our client requests a specific response and our API provides it,
              which is great...for now. However, this does leave our API and client
              coupled together - if our clients needs change in the future, then
              our API will also need to be updated even if it could already
              provide the field, our only options are all or nothing.
          </p>
          <h3>Asking For What We Need</h3>
      </section>
			<footer>
				  <h3>Footnotes</h3>
				  <ol class="footnotes">
					    <li id="footnote-1">
                  This is mostly an excuse for me to write <em>colour</em> with
                  the british spelling a bunch, because I normally don't get to
                  do that
              </li>
          </ol>
      </footer>
		</article>
		<footer class="page-footer">
			<div class="container">
				<a href="../index.html">&lt;- mmmM Delicious cOntent
			</div>
		</footer>
  </body>
</html>
